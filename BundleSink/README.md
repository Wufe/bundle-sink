# BundleSink

Manage multiple webpack entries within an ASPNET Core application.

***

### Requirements

- The library currently supports `netcoreapp3.1` applications.
- You need a webpack configuration for your bundles.

***

## Installation

- From the dotnet CLI:  
`dotnet add package BundleSink`

- Import tag helpers within `_ViewImports.cshtml`:  
`@addTagHelper *, BundleSink`

- From a command line:
`npm install webpack-assets-manifest`

- Update your webpack.config.js adding the plugin:
```js
    plugins: [
        new WebpackAssetsManifest({
            output: path.resolve(__dirname, 'client-manifest.json'),
            entrypoints: true
        })
    ]
```

- Initialize BundleSink in Program.cs:

```csharp
public static IHostBuilder CreateHostBuilder(string[] args) =>
    Host.CreateDefaultBuilder(args)
        .ConfigureWebHostDefaults(webBuilder =>
        {
            webBuilder
                .ConfigureBundleSink(builder => {
                    builder.WithWebpack("client-manifest.json", "/dist/");
                })
                .UseStartup<Startup>();
        });
```

> The function `WithWebpack` requires two arguments:
> - The name of the assets manifest created with webpack
> - The **public** output folder (i.e. the folder under wwwroot where the output is being generated by webpack)

***

## Usage

- Place a script-sink in your `_Layout.cshtml` or a razor page's "Scripts" section:  

*e.g.:  

```razor
<h1>Homepage</h1>

@section Scripts {
    <script-sink />
}
```

- Use a webpack entry from within a partial view / view-component, defining **the name of the entry**

```razor
This is a partial view from the homepage

<webpack-entry name="my-homepage-feature" />
```

***

## What happened
The `<webpack-entry>` tag helper marked the specified entry as a dependency.  
The `<script-sink>` tag helper uses the dependencies declared all over the razor pages, taking care of duplicates and required chunks

The html will contain the scripts required for the selected entries, with their hash appended as query string.  
*e.g.*
```html
<script type="text/javascript" src="/dist/my-homepage-feature.js?v=NMaMA8xzap806fSOec7CFpI78hl033lAOIq_Lrr4kmY"></script>
```

***

## Additional options

The webpack-entry accepts more options in form of attributes
- Use the attribute `key` if you need an entry to be imported more than once ... Why would you?  (Their dependencies will be imported once)
- Use the attribute `async` to mark the entry (but not its dependencies) as async
- Use the attribute `defer` to mark the entry (but not its dependencies) as deferred

**Named sinks**
You can also render a webpack-entry to a specific script-sink:
- Use the `name` attribute on the script-sink tag helper
- Use the `sink` attribute on the webpack-entry tag helper

*e.g.*
```razor
<webpack-entry sink="ABOVE" />
<script-sink name="ABOVE />
```

***

## TODO

- Add `requires` and `required-by` attributes for `<webpack-entry />` tag.  
Will help establish priority between entries.